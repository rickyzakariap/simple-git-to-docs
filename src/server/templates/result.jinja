{% extends "base.jinja" %}
{% block content %}
<div class="w-full max-w-5xl bg-white rounded-xl shadow-lg p-8 border-2 border-gray-900">
    <h2 class="text-2xl font-bold mb-4 text-green-700">Repository Browser</h2>
    <p class="mb-2 text-gray-600">Repo: <span class="font-mono text-blue-700">{{ repo_url }}</span></p>
    {% if doc_link %}
    <div class="mb-4">
        <a href="{{ doc_link }}" target="_blank" class="bg-yellow-400 hover:bg-yellow-300 border-2 border-gray-900 text-gray-900 font-semibold rounded px-6 py-3 transition-all shadow-lg">View Documentation</a>
    </div>
    {% endif %}
    {% if readme_html %}
    <div class="mb-6 p-4 bg-yellow-50 border-l-4 border-yellow-400 rounded">
        <h3 class="font-bold text-lg mb-2">README.md</h3>
        <div class="prose max-w-none">{{ readme_html | safe }}</div>
    </div>
    {% endif %}
    <div class="flex flex-col md:flex-row gap-6">
        <div class="w-full md:w-1/3">
            <h3 class="font-semibold mb-2">File Tree</h3>
            <ul id="file-tree" class="text-sm font-mono bg-gray-50 border rounded p-2 max-h-96 overflow-auto">
                {{ render_file_tree(file_tree, repo_url.split('/')[-1]) }}
            </ul>
        </div>
        <div class="w-full md:w-2/3">
            <div class="flex items-center justify-between mb-2">
                <h3 class="font-semibold">File Viewer</h3>
                <button onclick="copyFileViewer()" class="bg-yellow-400 hover:bg-yellow-300 border-2 border-gray-900 text-gray-900 font-semibold rounded px-4 py-1 text-sm transition-all shadow flex items-center gap-2" title="Copy file contents">
                    ğŸ“‹ Copy
                </button>
            </div>
            <pre id="file-viewer" class="bg-gray-900 text-yellow-100 rounded p-4 min-h-[300px] max-h-96 overflow-auto whitespace-pre-wrap">Select a file to view its contents.</pre>
        </div>
    </div>
    <form action="/" method="get" class="mt-6 text-center">
        <button type="submit" class="underline text-gray-600 hover:text-gray-900">Back to Home</button>
    </form>
</div>
<script>
function fetchFile(repo, path) {
    fetch(`/file?repo=${encodeURIComponent(repo)}&path=${encodeURIComponent(path)}`)
        .then(res => res.ok ? res.text() : res.text().then(t => 'Error loading file:\n' + t))
        .then(text => {
            document.getElementById('file-viewer').textContent = text;
        });
}
function setupFileTree() {
    document.querySelectorAll('.file-link').forEach(el => {
        el.addEventListener('click', function(e) {
            e.preventDefault();
            fetchFile(this.dataset.repo, this.dataset.path);
        });
    });
}
function copyFileViewer() {
    const pre = document.getElementById('file-viewer');
    const text = pre.textContent;
    navigator.clipboard.writeText(text).then(() => {
        alert('File content copied!');
    });
}
document.addEventListener('DOMContentLoaded', setupFileTree);
</script>
{% endblock %}
{% macro render_file_tree(tree, repo_name) %}
{% for node in tree %}
    {% if node.type == 'dir' %}
        <li><span class="font-bold">ğŸ“ {{ node.name }}</span>
            <ul class="ml-4 border-l border-gray-200 pl-2">{{ render_file_tree(node.children, repo_name) }}</ul>
        </li>
    {% else %}
        <li><a href="#" class="file-link text-blue-700 hover:underline" data-repo="{{ repo_name }}" data-path="{{ node.path }}">ğŸ“„ {{ node.name }}</a></li>
    {% endif %}
{% endfor %}
{% endmacro %} 